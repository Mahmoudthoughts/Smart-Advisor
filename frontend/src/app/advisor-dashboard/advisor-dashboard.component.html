<section class="dashboard" id="overview">
  <div class="demo-banner">Demo Data</div>
  <header class="hero">
    <div>
      <p class="eyebrow">{{ greeting() }}, {{ user()?.name ?? 'Investor' }}</p>
      <h1>Regret-aware intelligence for your portfolio</h1>
      <p class="lede">
        Track hypothetical liquidation, regret, narratives, and macro overlays across your Smart Advisor workspace.
      </p>
    </div>
    <a class="cta" routerLink="/login">Switch portfolio</a>
  </header>

  <section class="metrics-grid">
    <article *ngFor="let metric of overviewMetrics" [class]="'metric-card ' + metric.accent">
      <span class="label">{{ metric.label }}</span>
      <span class="value">{{ metric.value }}</span>
      <span class="delta">{{ metric.delta }}</span>
    </article>
  </section>
</section>

<section class="panel" id="performance">
  <header>
    <div>
      <h2>Performance timeline</h2>
      <p>Daily hypothetical liquidation alongside unrealized P&amp;L and closing price.</p>
    </div>
    <a class="view-link" routerLink="/app/timeline">View timeline</a>
  </header>
  <div echarts [options]="liquidationChart" [autoResize]="true" class="chart chart-lg"></div>
</section>

<section class="panel two-column" id="opportunities">
  <div class="panel-block">
    <header>
      <div>
        <h2>Top missed opportunities</h2>
        <p>Ranking by incremental regret delta versus realized path.</p>
      </div>
      <a class="view-link" routerLink="/app/opportunities">Explore opportunities</a>
    </header>
    <div class="table-controls">
      <label class="toggle">
        <input type="checkbox" [ngModel]="opportunityTableFirst()" (ngModelChange)="opportunityTableFirst.set($event)" />
        Table first (hide chart)
      </label>
      <button type="button" class="reset" (click)="resetOpportunityColumns()">Reset columns</button>
      <div class="column-toggles" role="group" aria-label="Toggle opportunity table columns">
        <label class="toggle">
          <input
            type="checkbox"
            [ngModel]="opportunityColumns().rank"
            (ngModelChange)="setOpportunityColumnVisibility('rank', $event)"
          />
          Rank
        </label>
        <label class="toggle">
          <input
            type="checkbox"
            [ngModel]="opportunityColumns().symbol"
            (ngModelChange)="setOpportunityColumnVisibility('symbol', $event)"
          />
          Symbol
        </label>
        <label class="toggle">
          <input
            type="checkbox"
            [ngModel]="opportunityColumns().missedGain"
            (ngModelChange)="setOpportunityColumnVisibility('missedGain', $event)"
          />
          Missed gain
        </label>
        <label class="toggle">
          <input
            type="checkbox"
            [ngModel]="opportunityColumns().driver"
            (ngModelChange)="setOpportunityColumnVisibility('driver', $event)"
          />
          Driver
        </label>
      </div>
    </div>
    <div echarts [options]="opportunityChart" [autoResize]="true" class="chart" *ngIf="!opportunityTableFirst()"></div>
    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th *ngIf="opportunityColumns().rank">#</th>
            <th *ngIf="opportunityColumns().symbol">Symbol</th>
            <th *ngIf="opportunityColumns().missedGain">Missed gain</th>
            <th *ngIf="opportunityColumns().driver">Driver</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of opportunities">
            <td data-label="Rank" *ngIf="opportunityColumns().rank">{{ row.rank }}</td>
            <td data-label="Symbol" *ngIf="opportunityColumns().symbol">{{ row.symbol }}</td>
            <td data-label="Missed gain" *ngIf="opportunityColumns().missedGain">{{ row.missedGain }}</td>
            <td data-label="Driver" *ngIf="opportunityColumns().driver">{{ row.driver }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="panel-block" id="signals">
    <header>
      <div>
        <h2>Active advisor signals</h2>
        <p>Rules, sentiment, and predictor insights requiring attention.</p>
      </div>
      <a class="view-link" routerLink="/app/signals">Review signals</a>
    </header>
    <ul class="signals">
      <li *ngFor="let signal of signals" [class]="signal.severity">
        <div class="signal-header">
          <span class="badge">{{ signal.symbol }}</span>
          <span class="label">{{ signal.label }}</span>
        </div>
        <p>{{ signal.context }}</p>
      </li>
    </ul>
  </div>
</section>

<section class="panel two-column" id="alerts">
  <div class="panel-block">
    <header>
      <div>
        <h2>Recent alerts</h2>
        <p>Automated explanations generated by the advisor reasoning engine.</p>
      </div>
      <a class="view-link" routerLink="/app/alerts">Go to alerts</a>
    </header>
    <ul class="alerts">
      <li *ngFor="let alert of alerts">
        <div class="alert-symbol">{{ alert.symbol }}</div>
        <div class="alert-body">
          <p>{{ alert.message }}</p>
          <span class="timestamp">{{ alert.timestamp }}</span>
        </div>
      </li>
    </ul>
  </div>
  <div class="panel-block" id="macro">
    <header>
      <div>
        <h2>Upcoming macro events</h2>
        <p>Overlay these on your timeline to anticipate regret swings.</p>
      </div>
      <a class="view-link" routerLink="/app/macro">View macro calendar</a>
    </header>
    <ul class="macro">
      <li *ngFor="let event of macroEvents">
        <div class="event-header">
          <span class="name">{{ event.label }}</span>
          <span class="pill" [class]="event.importance.toLowerCase()">{{ event.importance }}</span>
        </div>
        <p class="event-date">{{ event.date }}</p>
        <p class="event-note">{{ event.takeaway }}</p>
      </li>
    </ul>
  </div>
</section>
